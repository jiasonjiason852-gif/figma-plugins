# 又拍云配置指南

将代理的图床从 ImgBB 切换到又拍云，匠紫可稳定拉取国内 CDN 图片。

## 一、创建存储空间

1. 登录 [又拍云控制台](https://console.upyun.com/)
2. 进入 **云存储** → **存储管理**
3. 点击 **创建服务**
4. 填写：
   - **服务名称**：如 `figma-hd`（即 bucket 名）
   - **业务类型**：图片
   - **加速区域**：按需选择（国内建议选离匠紫近的）
5. 创建完成后，记下**服务名称**（bucket）

## 二、创建操作员

1. 右上角头像 → **账户管理** → **操作员管理**
2. 点击 **创建操作员**
3. 填写：
   - **操作员名**：如 `figma-upload`
   - **密码**：设置强密码并保存
4. 在 **授权管理** 中为该操作员勾选：
   - 可读取
   - 可写入
   - 可删除（可选）
5. 服务选择：勾选刚创建的存储空间
6. 保存后记下**操作员名**和**密码**

## 三、绑定域名（获取公网访问地址）

1. 进入 **云存储** → 选择你的服务 → **域名管理**
2. 默认会有一个 **又拍云测试域名**：`<服务名>.b0.upaiyun.com`
3. 若要自定义域名：添加加速域名并完成 CNAME 解析
4. 图片公网 URL 格式：`https://<域名>/<文件路径>`

## 四、配置代理环境变量

在 `proxy/.env` 或 Railway Variables 中添加：

```
UPYUN_BUCKET=你的服务名
UPYUN_OPERATOR=你的操作员名
UPYUN_PASSWORD=你的操作员密码
```

可选：若使用自定义域名，添加 `UPYUN_DOMAIN=你的加速域名`（如 `cdn.example.com`），不填则用 `<服务名>.b0.upaiyun.com`。

优先级：若同时配置了 `IMGBB_API_KEY` 和 `UPYUN_*`，代理会优先使用又拍云。

## 五、验证

1. 启动代理：`cd proxy && npm start`
2. 测试上传：用插件选中一张图片执行高清化
3. 若日志显示 `[img] 又拍云公网 URL: https://xxx`，说明配置成功
